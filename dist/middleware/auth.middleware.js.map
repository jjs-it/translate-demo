{"version":3,"sources":["../../src/middleware/auth.middleware.js"],"names":["_","require","AuthService","ProfileService","module","exports","req","res","next","token","headers","Errors","NO_TOKEN","startsWith","INVALID_TOKEN_TYPE","payload","verifyToken","substring","INVALID_TOKE","findProfileById","_id","user","console","log","status","send","result","message"],"mappings":";;AAGA;;;;;;;;AAHA,IAAMA,IAAIC,QAAQ,QAAR,CAAV;;eAEwCA,QAAQ,aAAR,C;IAAhCC,W,YAAAA,W;IAAaC,c,YAAAA,c;;AAGrBC,OAAOC,OAAP;AAAA,qEAAiB,iBAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEPC,iBAFO,GAECH,IAAII,OAAJ,CAAY,eAAZ,CAFD;;AAAA,kBAGTD,UAAU,IAHD;AAAA;AAAA;AAAA;;AAAA,kBAILE,gBAAOC,QAJF;;AAAA;AAAA,gBAMRH,MAAMI,UAAN,CAAiB,SAAjB,CANQ;AAAA;AAAA;AAAA;;AAAA,kBAOLF,gBAAOG,kBAPF;;AAAA;AASPC,mBATO,GASGb,YAAYc,WAAZ,CAAwBP,MAAMQ,SAAN,CAAgB,CAAhB,CAAxB,CATH;;AAAA,kBAUTF,WAAW,IAVF;AAAA;AAAA;AAAA;;AAAA,kBAWLJ,gBAAOO,YAXF;;AAAA;AAAA;AAAA,mBAcMf,eAAegB,eAAf,CAA+BJ,QAAQK,GAAvC,CAdN;;AAAA;AAcPC,gBAdO;;AAAA,kBAeTA,QAAQ,IAfC;AAAA;AAAA;AAAA;;AAAA,kBAgBLV,gBAAOO,YAhBF;;AAAA;AAkBbZ,gBAAIe,IAAJ,GAAWA,IAAX;AACAb;AAnBa;AAAA;;AAAA;AAAA;AAAA;;AAqBbc,oBAAQC,GAAR;AACAhB,gBAAIiB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,sBAAQ,OADW;AAEnBC;AAFmB,aAArB;;AAtBa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAjB;;AAAA;AAAA;AAAA;AAAA","file":"auth.middleware.js","sourcesContent":["const _ = require('lodash');\r\n\r\nconst { AuthService, ProfileService } = require('../services');\r\nimport Errors from '../constants/error.constant';\r\n\r\nmodule.exports = async (req, res, next) => {\r\n  try {\r\n    const token = req.headers['authorization'];\r\n    if (token === null) {\r\n      throw Errors.NO_TOKEN;\r\n    }\r\n    if (!token.startsWith('Bearer ')) {\r\n      throw Errors.INVALID_TOKEN_TYPE;\r\n    }\r\n    const payload = AuthService.verifyToken(token.substring(7));\r\n    if (payload == null) {\r\n      throw Errors.INVALID_TOKE;\r\n    }\r\n\r\n    const user = await ProfileService.findProfileById(payload._id);\r\n    if (user == null) {\r\n      throw Errors.INVALID_TOKE;\r\n    }\r\n    req.user = user;\r\n    next();\r\n  } catch (err) {\r\n    console.log(err)\r\n    res.status(400).send({\r\n      result: 'error',\r\n      message: err,\r\n    });\r\n  }\r\n};\r\n"]}